---
import Layout from '../../layouts/Layout.astro';
import { getProducts } from '../../lib/products.js';

let products = getProducts();
let cart = [];

function handleAdd(productId) {
    const product = products.find(p => p.id === productId);
    const existing = cart.find(i => i.id === productId);
    if (existing) {
        existing.cantidad += 1;
    } else {
        cart.push({ ...product, cantidad: 1 });
    }
}

function handleSend() {
    // Aquí se guarda en la tabla sales como pendiente
    alert("Pedido enviado a caja!");
    cart = [];
}
---

<Layout title="Lista de Precios">
    <h1 class="text-2xl font-bold mb-4">Lista de Precios</h1>
    <table class="w-full bg-white shadow-md rounded">
        <thead>
        <tr class="bg-gray-200">
            <th class="p-2">Código</th>
            <th class="p-2">Nombre</th>
            <th class="p-2">Rubro</th>
            <th class="p-2">Precio</th>
            <th class="p-2">Acción</th>
        </tr>
        </thead>
        <tbody>
        {products.map(p => (
            <tr>
            <td class="p-2">{p.code}</td>
            <td class="p-2">{p.name}</td>
            <td class="p-2">{p.rubro}</td>
            <td class="p-2">${p.price_minorista}</td>
            <td class="p-2">
                <button class="bg-green-600 text-white px-2 py-1 rounded" on:click={() => handleAdd(p.id)}>Agregar</button>
            </td>
            </tr>
        ))}
        </tbody>
    </table>

    <div class="bg-white p-4 rounded shadow-md mt-4">
        <h2 class="text-xl font-bold mb-2">Carrito</h2>
        <ul>
        {cart.map(i => (
            <li>{i.name} x{i.cantidad} = ${i.price_minorista * i.cantidad}</li>
        ))}
        </ul>
        <button class="bg-blue-600 text-white px-4 py-2 rounded mt-2" on:click={handleSend}>Enviar pedido a caja</button>
    </div>
</Layout>